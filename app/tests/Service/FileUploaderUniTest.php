<?php

namespace App\Test\Service;

use PHPUnit\Framework\MockObject\MockObject;
use PHPUnit\Framework\TestCase;
use League\Flysystem\FilesystemInterface;


class FileUploaderUniTest extends  TestCase
{
    public function testSuccessUploadBase64File()
    {
        $base64Image    = "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBw0PDQ8NDw8PDw8NDw8NDw8PDw8ODg8NFREWFhYRFRUYHSggGBolGxUVIzEhJTUrLi4uFx8zODMsNygtMCsBCgoKDg0OGhAQGysdHSAtLy0tLSstLS0tNysrLSstLS0tLS0tLS0rNystLS0tLS0tLS0rLS0tLS0tLSsrKy0rLf/AABEIAKgBLAMBIgACEQEDEQH/xAAbAAEAAgMBAQAAAAAAAAAAAAAAAgMBBAUGB//EAEMQAAIBAgIECQoEBAYDAQAAAAABAgMRBCEFEjFRBiJBYXGBkbHBBxMjMlNyc5Kh0TRSdLIUFTNiFjVDouHwQoLDJP/EABgBAQADAQAAAAAAAAAAAAAAAAACAwQB/8QAHxEBAAICAwEBAQEAAAAAAAAAAAECETEDEiEyQVET/9oADAMBAAIRAxEAPwD7YAAAAAAAAAAAAAAyR1lvXagMgxrLeu1DWW9dqAyDGut67UNdb12oDIMa63rtQ1lvXagMgxrreu1DXW9dqAyDGut67UNdb12oDIMa63rtQ11vXagMgxrreu1DXW9dqAyAnfZmZAwAAAAAAAAAAAAAAAAAAAAAAEatSMIynJqMYRcpSexRSu2Br6T0jRw1J1q01GKyW+TteyXK8n2NvJHzjSvD7GV244SKo0uSpLOUl08vVa3JKSONwk0zPSGKlOV1QpNwp0+R2ex9aV98lyqMbaLq52irv6IurTG1Nr502K9bFVXetiqs+bJr/fd/Up/govbUqdTiu5GjXxsVfjOW/VtGPzM6GiMLDE09dSnk3FqElNLrXMTwqmWI4Cktk6i5lJJdxJYCn7Sr86+xvrQUH/qVPoSXB+Ptan0O4MtBaOpe0q/OvsTWjaXtKvzr7G//AIeh7Wp9A+D35a9RPnipeKBlprRNP2lb519ia0PT9pW+dfYjXwmKocbKrBbXG+slvaNnB4uNRKzOClaFpe0rfOvsSWhKXtK3zr7G+mTQdc7+R0vaVvnX2M/yKl7St86+x0kySA5i0DR9pW+dfYz/ACCj7St86+x00SQccv8AkFH2lb519h/h+j+et86+x1UZDrlx0HCPqVq0HvXmn3xNvD4nSuGzo4p14r/Tqtptble8V1JdJtGTmCJw7vBzhpTxE/4fEQ/h8RlGz4sJSeSyberd7M2ndca7serPlmksBGvG3q1I383Usm4vc98Xsae09RwC09PEUpYav+Iw3Fd3dygrLa83a6ze1Sjdt3K7Vx7C6l8+S9WACtYAAAAAAAAAAAAAAAAHlvKTpF0NGz1XaVaSprscuxtRi/ePUnz3yv1H5vB0+SpOd1zqpQafZclXaN58eAtqQjCO3KPXys52ndIKjF0452spW2zqPZDoX3Ojf00FuuzxWmsQ3LWvnqVK1/7pNrwuX5xGWeIzOGhisY5S4z15J8rfm4vckv8AvSdvghpmtTxCpqrKnGpdLVUbecWaumrcjXWeZwsL/RI23DVnUlCTvQdOSbVm5Zc+/wChXEWtHZfisePtuidKfxF6VRRjiIrWjKOUK0Vtyex83/Nt+Ez55ovSV6mGrRybqUpLrklJdjaPfV5pVqsd0l9YqXeyylsx6o5K9Z8b+jqSqVLPYsz0ywsPNequiysePweMdKop7Vyo9J/iLDeb2522cpRz1tM+L+C1Ir64mlKap1MuVXR5bStFUqka8Mo1JatSK2Ke9dJ3NI47ztRz2LYlzHK0m9bD1VujrLpi7+BfWJ6+s9pjtONL6NS8Uy5M5ui6l6S6DfTDq1MkitMkmBYiSZWmSTAmiSIJmUwJoyRTMgZNPCV/4bS2FrrKOIao1Nzd9W76ITk//RbjbORwkk4wpVF60KstV7m6U0n22OSROH2EwZZgztQAAAAAAAAAAAAAAAAfOfK/t0ev768uaylR+6Pox858sOzR/wAWr30iVNoX+XgU/TL3ZHi8bC8Yt7Empe5JJN9WXaexT9Mvdl3HmFC8V0GjGYZ84nLznGpyaf8Aw1yNEnWvfbm7vne86lfCcllb8sk3Fe61mugoWEitkI9cqkl2ZFXS0eQu/wBKzt6HgHSdSpFzyo4efnXJ5Ry42r25vmPoFLFObnVeXnJOSvt1dkfokfN9C1ZxqRjKT1JNRa2K3IrLJK57WpXVow5JPP3Vt8F1lla4jCm9u0uhVx9OEfOVanm6b9XLWnP3Y+JrQ4T6PvZ0sW1+dOkuu1zyWLxkq1R1G9vqr8sORf8AeUps/pfqITefxZHFH6+j0VSxFOVXCVfPKGc6Ulq4iC3uPL1dVzn4ipelV56c/wBrPI6Mx9TDVoV6TtOm725JQ5YPmZ7XT0IKU6lPKGIw/n4rdrJ3Xbn1k627QrvTrLV0S/Ro6CkczRj9GjeUg62EyaZrqRNSAvTJplKZJMC5MymVpkkwLEyRWmSQEjj8KHahF8kasZPfZRkdc5HCV+hp/Hp9zA+xLYBHYuhAzNQAAAAAAAAAAAAAAAAfOPLFs0f8Sr30j6OfOPLHswHxKvfSJU2hf5fPU/TL3Zdx52k+Kug9An6Ze7LuPL1KzjCKWcpcWKey+98yNEM0+rataMfWaXTtfVtKli6X5lnzSXgcirieM9V3fLN5yk963Iiq1RZ60ut3T6mVzyrY4Xd59+aa2dTPRUsVrwpSb9ZOEnulbPuZ4vBYq18sts4LY1s147mj0OjXrKdK+6cGt+9fRlkTEwqtWay0YVXGUoSylFuLXOsmbyx+zixyzvqrWv7223MRx2CVd+sqWIStxr6lVJZPLPrV+dcpqw0Ljr21Itb1VpW77kIm1PF+a29X053yWb2JcrZ7vS8tVU8PteHwUYS5bSa2f7fqeZ0TgqeEkq1eUauIjnSoQd0pckpPm37Fzux0aVSclWqVHrTqRlKb5L22LmSsuoUrj2VfJaJxEN3Rr9GjcUjQ0e/Ro20yTi9SJxka6ZNSA2VInGRrRkWKQGwmTTKFImpAXpkkyqMiaYE7nJ4S/wBGn8en3M6qZyuEf9Kl+op+IH2OOxdCBzeDOKq1sDhq1VqVWpSjKcox1YuW9LkOkZmqAAAAAAAAAAAAAAAAA+b+WXZgPiVe+kfSD5t5ZvVwHxKvfSJU2hf5fPI/1o86aPF4yTz/ALaE2nuk3qv6WPY1XaSluZ5zTeG1KraV4vWml+alP1ornXgXTpRWcS4WCpqUrN2V4pvdFvNm06MLVmrrzcqcY3le7d7rxNOpCVJ3TvF+rL/xktz3PmISr8yXOQreIrMTHq+YmZzldhH6aK5G3F+600/pc7ujsQ4+anuST6E2u44uDoSXGeUpJqKe1JrOb3ZX7Tq01ZJdXUS448Vc0+vVVo0pQbnbVSu29iW85f8AG4e9lKtq71KSj2XuaeNxMnhYLdNRl0JO3h2HPpyF7zE4gpSJjMvX4anTUdanbjJtS5G+fl2mzRm3Cba1W6eabTs3HNX5czjaBk9Sa5FJW6bZ+B1KkrU3vm1FdHKSicxlC0YnDpYD+mjaTNbDq0UuYuuHViZJMqTJJgXKRYpGumTUgNiMiyMjWUiyMgNmMixSNaMiyMgL0zm8IX6Kl+op+JvKRzeET9DT+PT7mB9P4GTUtGYOS2OjFrJrK75DsmILJdCMmeWmPAAHHQAAAAAAAAAAAAAPm3ln9XAfErd9I+knzDyy4mm5YOipJ1KUpVJxzvGFRxUH1+bn8pKm0L/LwDzujVxNCM4+bqXss4TXrQf25jYTJ7S9neaxGia0G3BOcXtdPjRl70DSWFnF+q4vmowpy6ms0ew8wuRtdBJQn+eXaMQZn+vJU6DXI883tbfSy3Ve59jPVqFT2ku0mo1PaS7TuXMPNYKKbdOcW41FZqz2rNM2IcH88pytu1Ly7T0MVU9oyWrN7Zs5MRO0omY01cPg1Tgo21Yrf6zZbQouc1OWUY5RXIi+NBbXd9Jeg4sTM3K7kkw6nckmV3M3AtTJJlSZJMC1SLIyKEySYGxGRZGRrJlkZAbKkc/T2dKkt9en4m2pGjpp+jpfqKfiB9l0Zi418PRrxTjGtThUUZZSSkr2fObJzeDX4DC/Ap9x0jNLTGgAB0AAAAAAAAAAAAAD5F5XvxtP3MP+6ofXT5D5YPxlP3MP+6oTptDk08XcmmUpk0y5nXJk0ymLJpgXJk0ylMmmBamTTKUyaYdWpkrlSZJMCxMkmVpmbgWJmbkEzKYFiZJMrTMpgWJkkytMkmBamTTKUySYF6kael3xKX6in4mwmamlXxaX6in4gfYuDP4DC/Ap9x0jl8FpJ6OwklseHpNdDijqGedtMaAAcdAAAAAAAAAAAAAA+QeWH8ZT9zD/ALqh9fPkHli/GQ9zD/uqE6bQ5NPDJk0ypMkmXM65MkmVJkkwL0ySZSmTTAuTJplKZNMC1MmmUpk0wLUzKZWmSTDqxMymQTMpgWJkkytMkmBNMkmVpkkwLEySZWmSTAsTNPSz4lP49PxNlM1tJPi0vj0/ED7vTS1Va1rK1tlrchk5fBaKWjsHFbFh6SXQoo6hmagAAAAAAAAAAAAAAAA+P+WJ/wD7Ie5h/wB1Q+wHyvy14WnF4Suo2qVW6c5XfGhTacFbZk6k+3oJU2hyfL5umSTK0ySZezrEyaZUmSTAtTJplSZJMC5MmmUpk0wLUyaZSmTTAtTJplSZJMC1MyiCZlMOrEySZWSTAsTMpkEySYE0ySZWmSTAsTNXSXq0v1FPxNhM1tI+rS+PS8QPtHBj/L8J8Cn+06ZzODH+X4T4FP8AadMzztpjQADjoAAAAAAAAAAAAAHzHy3/ANPAfErf/IAlTaF/l8tRJMAuZ0kySYB0STJpmABNMmmABNMkmZAEkyaZgATTJJmQBlMkmAHUkySYAGUySYAEkzV0i+LS+PT8QAPuui8HHD4ejh4yco0acKalL1pKKtd85sgGZqAAAAAAAAf/2Q==";
        //
        $data = explode(',', $base64Image);
        /**
         * @var FilesystemInterface&MockObject $filesystem
         */

        $filesystem = $this->getMockBuilder(FilesystemInterface::class)
            ->disableOriginalConstructor()
            ->getMock();

        $filesystem
            ->expects(self::exactly(1))
            ->method('write')
            ->with($this->isType('string'), base64_decode($data[1]));

        //
        $fileUploader   = new FileUploader($filesystem);
        $filename       = $fileUploader->uploadBase64File($base64Image);
        $this->assertNotEmpty($filename);
        $this->assertContains('.jpeg', $filename);
    }
}

